<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <title>Форма данных</title>
  <style>
    /* Общие сбросы */
    *, *::before, *::after { box-sizing: border-box; }
    html, body { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; font-family: sans-serif; }
    :root {
      --bg-color: #ffffff;
      --text-color: #000000;
      --input-bg: #f0f0f0;
      --input-border: #888888;
      --input-valid: #3a3a3a;
      --input-invalid: #ff3333;
      --button-bg: #2a86ff;
      --button-text: #ffffff;
      --error-color: #ff3333;

      /* Размеры текстов и отступов */
      --label-size: 0.7rem;
      --input-font: 0.7rem;
      --input-padding: 0.4rem;
      --group-gap: 0.7rem;
      --button-font: 0.7rem;
      --button-padding: 0.6rem;
      --h-padding: 1rem; /* Горизонтальный отступ */
      --v-padding: 2rem; /* Вертикальный отступ сверху */
    }
    [data-theme="dark"] {
      --bg-color: #1e1e1e;
      --text-color: #f9f9f9;
      --input-bg: #2a2a2a;
      --input-border: #555555;
      --input-valid: #77dd77;
      --input-invalid: #ff6666;
      --button-bg: #4a90e2;
      --button-text: #ffffff;
      --error-color: #ff6666;
    }
    body { background-color: var(--bg-color); color: var(--text-color); }
    .container {
      display: flex;
      flex-direction: column;
      align-items: stretch;
      justify-content: center;
      /* Добавляем вертикальный отступ сверху с учётом Safe Area */
      padding: calc(env(safe-area-inset-top) + var(--v-padding)) var(--h-padding) env(safe-area-inset-bottom) var(--h-padding);
      height: 100%;
      width: 100%;
    }
    /* Форма занимает всю высоту контейнера */
    form { display: flex; flex-direction: column; width: 100%; height: 100%; }
    .form-group { margin-bottom: var(--group-gap); display: flex; flex-direction: column; }
    /* Расширяем блок для товара, если остается свободное пространство */
    #group-product { flex: 1; display: flex; flex-direction: column; }
    #group-product input { flex: 1; }

    label { margin-bottom: 0.25rem; font-weight: bold; font-size: var(--label-size); color: var(--text-color); }
    input, select {
      padding: var(--input-padding);
      font-size: var(--input-font);
      background-color: var(--input-bg);
      color: var(--text-color);
      border: 1px solid var(--input-border);
      border-radius: 0.4rem;
      width: 100%;
    }
    input:valid, select:valid { border-color: var(--input-valid); }
    input:invalid, select:invalid { border-color: var(--input-invalid); }
    .error { color: var(--error-color); font-size: 0.75rem; display: none; }
    button {
      padding: var(--button-padding);
      font-size: var(--button-font);
      border: none;
      border-radius: 0.4rem;
      background-color: var(--button-bg);
      color: var(--button-text);
      cursor: pointer;
      margin-top: var(--group-gap);
    }
    button:active { opacity: 0.8; }
    @media (orientation: landscape) {
      .container {
        /* Ландшафтный режим: сохраняем вертикальный отступ сверху */
        padding: calc(env(safe-area-inset-top) + var(--v-padding)) var(--h-padding);
      }
      form { flex-direction: row; flex-wrap: wrap; justify-content: space-between; height: auto; }
      .form-group { width: 48%; }
      #group-product { width: 100%; flex: none; }
      button { width: 48%; align-self: center; }
    }
  </style>
</head>
<body>
  <div class="container">
    <form id="dataForm" novalidate>
      <div class="form-group">
        <label for="date">Дата</label>
        <input type="date" id="date" required>
        <div class="error">Пожалуйста, выберите дату.</div>
      </div>
      <div class="form-group">
        <label for="time">Время</label>
        <input type="time" id="time" required>
        <div class="error">Пожалуйста, выберите время.</div>
      </div>
      <div class="form-group">
        <label for="store">Магазин</label>
        <input type="text" id="store" required minlength="2">
        <div class="error">Введите название магазина.</div>
      </div>
      <div class="form-group" id="group-product">
        <label for="product">Наименование товара</label>
        <input type="text" id="product" required minlength="2">
        <div class="error">Введите название товара.</div>
      </div>
      <div class="form-group">
        <label for="total">Итого</label>
        <input type="number" id="total" required step="0.01" min="0">
        <div class="error">Введите корректную сумму.</div>
      </div>
      <div class="form-group">
        <label for="currency">Валюта</label>
        <select id="currency" required>
          <option value="">Выберите валюту</option>
          <option value="RUB">RUB</option>
          <option value="USD">USD</option>
          <option value="EUR">EUR</option>
        </select>
        <div class="error">Выберите валюту.</div>
      </div>
      <button type="submit">Отправить</button>
    </form>
  </div>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <script>
    // Подстройка размера шрифта (уменьшаем масштаб для 6" экрана)
    function adjustFont() {
      const base = Math.max(window.innerWidth, window.innerHeight) / 35;
      document.documentElement.style.fontSize = base + 'px';
    }
    adjustFont();
    window.addEventListener('resize', adjustFont);

    document.addEventListener('DOMContentLoaded', () => {
      if (window.Telegram && Telegram.WebApp) {
        const tg = Telegram.WebApp;
        tg.ready();
        // Переход в настоящий полноэкранный режим
        if (tg.requestFullscreen) {
          tg.requestFullscreen();
        } else {
          tg.expand();
        }
        const theme = tg.colorScheme || 'light';
        document.body.setAttribute('data-theme', theme);
      }

      const form = document.getElementById('dataForm');
      const fields = ['date','time','store','product','total','currency'];
      fields.forEach(id => {
        const input = document.getElementById(id);
        input.addEventListener('input', () => {
          const err = input.nextElementSibling;
          err.style.display = input.checkValidity() ? 'none' : 'block';
        });
      });

      form.addEventListener('submit', e => {
        e.preventDefault();
        let valid = true;
        fields.forEach(id => {
          if (!document.getElementById(id).checkValidity()) valid = false;
        });
        if (!valid) return;

        const data = {};
        fields.forEach(id => data[id] = document.getElementById(id).value);
        if (window.Telegram && Telegram.WebApp) {
          Telegram.WebApp.sendData(JSON.stringify(data));
        } else console.log(data);
      });
    });
  </script>
</body>
</html>
